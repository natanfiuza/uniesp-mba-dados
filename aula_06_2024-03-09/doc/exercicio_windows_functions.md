
```sql
--EXIBA O CPF, DATA E TOTAL DE COMPRAS DO CLIENTE NO 
--DIA, O TOTAL VENDIDO NO MESMO DIA PARA TODOS OS CLIENTES
--E O QUANTO O TOTAL DO CLIENTE REPRESENTA EM RELA��O
--AO TOTAL GERAL


SELECT DISTINCT C.CPF, CAST(V.DATA AS DATE) AS DATA
,SUM(IV.TOTAL) OVER(PARTITION BY C.CPF, V.DATA) TOTAL_CLIENTE_NO_DIA
,SUM(IV.TOTAL) OVER(PARTITION BY V.DATA) TOTAL_VENDAS_DIA

,
CAST(
	SUM(IV.TOTAL) OVER(PARTITION BY C.CPF, V.DATA)
	/
	SUM(IV.TOTAL) OVER(PARTITION BY V.DATA)
	*100 
	AS NUMERIC(5,2)
)
AS PERCENT_SOBRE_TOTAL_DO_DIA
FROM VENDAS V
INNER JOIN CLIENTES C ON (V.IDCLIENTE = C.IDCLIENTE)
INNER JOIN ITENS_VENDAS IV ON (IV.IDVENDA = V.IDVENDA)
ORDER BY CAST(V.DATA AS DATE), C.CPF;
GO

;WITH
TOTAL_VENDAS_CLIENTE_DIA
AS
(
	SELECT V.DATA, C.CPF, SUM(IV.TOTAL) AS TOTAL
	FROM VENDAS V
	INNER JOIN CLIENTES C ON (V.IDCLIENTE = C.IDCLIENTE)
	INNER JOIN ITENS_VENDAS IV ON (IV.IDVENDA = V.IDVENDA)
	GROUP BY C.CPF, V.DATA
)
SELECT DATA, CPF
,SUM(TOTAL) OVER(PARTITION BY CPF, DATA) AS TOTAL_CLIENTE_DIA
,SUM(TOTAL) OVER(PARTITION BY DATA) AS TOTAL_VENDAS_DIA
,
CAST(
	SUM(TOTAL) OVER(PARTITION BY CPF, DATA)
	/
	SUM(TOTAL) OVER(PARTITION BY DATA)
	*100 
	AS NUMERIC(5,2)
) AS PERCENT_SOBRE_TOTAL_DO_DIA
FROM TOTAL_VENDAS_CLIENTE_DIA
ORDER BY DATA, CPF
GO






SELECT V.DATA, C.CPF, SUM(IV.TOTAL) AS TOTAL
,SUM(SUM(IV.TOTAL)) OVER(PARTITION BY CPF, DATA) AS TOTAL_CLIENTE_DIA
,SUM(SUM(IV.TOTAL)) OVER(PARTITION BY DATA) AS TOTAL_VENDAS_DIA
,
CAST(
	SUM(SUM(IV.TOTAL)) OVER(PARTITION BY CPF, DATA)
	/
	SUM(SUM(IV.TOTAL)) OVER(PARTITION BY DATA)
	*100 
	AS NUMERIC(5,2)
) AS PERCENT_SOBRE_TOTAL_DO_DIA
FROM VENDAS V
INNER JOIN CLIENTES C ON (V.IDCLIENTE = C.IDCLIENTE)
INNER JOIN ITENS_VENDAS IV ON (IV.IDVENDA = V.IDVENDA)
GROUP BY C.CPF, V.DATA
ORDER BY DATA, CPF
GO
```