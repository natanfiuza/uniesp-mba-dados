USE DISCIPLINA02
GO

--DROP TABLE FUNCIONARIOS;

--1) CRIE UMA TABELA DE NOME FUNCIONARIOS COM OS SEGUINTES CAMPOS
/*
	IDFUNCIONARIO INTEIRO OBRIGATÓRIO AUTOINCREMENTO INICIANDO EM 1 E INCREMENTO DE 1
	NOME ATÉ 100 CARACTERES OBRIGATÓRIO
	RG ATÉ 9 CARACTERES OBRIGATÓRIO
	UF DO RG, OBRIGATÓRIO
	CPF 11 CARACTERES, OBRIGATÓRIO, ÚNICO
	DT_CONTRATACAO DATA E HORA, OBRIGATÓRIO
	DT_DEMISSAO DATA E HORA, OPCIONAL
	LOGRADOURO OBRIGATÓRIO

	IDFUNCIONÁRIO É A CHAVE PRIMÁRIA
	O PAR RG E UF DO RG É ÚNICO
*/

CREATE TABLE FUNCIONARIOS(
	IDFUNCIONARIO INT NOT NULL IDENTITY(1,1),
	NOME VARCHAR(100) NOT NULL,
	RG CHAR(9) NOT NULL,
	IDUF_RG INT NOT NULL,
	CPF CHAR(11) NOT NULL,
	DT_CONTRATACAO DATETIME NOT NULL,
	DT_DEMISSAO DATETIME NULL,
	IDLOGRADOURO INT NOT NULL,

	CONSTRAINT PK_FUNCIONARIOS PRIMARY KEY(IDFUNCIONARIO),
	CONSTRAINT UNQ_FUNCIONARIOS_CPF UNIQUE(CPF),
	CONSTRAINT UNQ_FUNCIONARIOS_RG_ID_UF_RG UNIQUE(RG,IDUF_RG),
	CONSTRAINT FK_FUNCIONARIOS_UFS FOREIGN KEY(IDUF_RG)
	REFERENCES UFS(IDUF),
	CONSTRAINT FK_FUNCIONARIOS_LOGRADOUROS FOREIGN KEY(IDLOGRADOURO)
	REFERENCES LOGRADOUROS(IDLOGRADOURO)
);


--2) INSIRA OS SEGUINTES REGISTROS NA TABELA
/*
	FULANO, 111111111, 1, 11111111111, 20/01/2016, NULL, 5
	BELTRANO, 222222222, 2, 22222222222, 01/03/2015, NULL, 7
	TRAJANO, 333333333, 3, 33333333333, 30/06/2015, NULL, 8
	ALUNO, 444444444, 4, 44444444444, 01/12/2014, NULL, 9
*/

SELECT L.IDLOGRADOURO,U.UF, U.IDUF
FROM LOGRADOUROS L
INNER JOIN BAIRROS B ON (B.IDBAIRRO = L.IDBAIRRO)
INNER JOIN CIDADES C ON (C.IDCIDADE = B.IDCIDADE)
INNER JOIN UFS U ON (U.IDUF = C.IDUF)
WHERE L.IDLOGRADOURO IN(1,2,3,4);

INSERT INTO FUNCIONARIOS
(NOME, RG, IDUF_RG, CPF, DT_CONTRATACAO, DT_DEMISSAO, IDLOGRADOURO)
VALUES
('FULANO', '111111111', 5, '11111111111', '20160120', NULL, 1),('BELTRANO', '222222222', 7, '22222222222', '20150301', NULL, 2),
('TRAJANO', '333333333', 27, '33333333333', '20150630', NULL, 3), ('ALUNO', '444444444', 9, '44444444444', '20141201', NULL, 4);

SELECT *
FROM FUNCIONARIOS;

--3) ALTERE O NOME DE TRAJANO PARA CICRANO E, AO MESMO TEMPO, SUA DATA DE CONTRATACAO PARA 01/12/2013

UPDATE FUNCIONARIOS
SET NOME = 'CICRANO', DT_CONTRATACAO = '20131201'
WHERE NOME = 'TRAJANO';

SELECT *
FROM FUNCIONARIOS
WHERE NOME = 'CICRANO';


--4) REMOVA O REGISTRO DE "ALUNO"

DELETE FROM FUNCIONARIOS
WHERE NOME = 'ALUNO';

SELECT *
FROM FUNCIONARIOS;